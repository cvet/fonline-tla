namespace SeMadBrahmins
{

#if SERVER

// Autor: Cracker
// Mad Brahmins special encounter scripts

#define ENTRY_BRAHMIN (107)

void _BrahminInit(Critter br, bool firstTime)
{
    br.OnCritterAppeared.Subscribe(_Show);
    br.OnAttack.Subscribe(_Bah);
}

void _Show(Critter br, Critter showCrit)
{
    Messaging::Say(br, "Mooo...");
    if (showCrit.ControlledByPlayer) {
        NpcPlanes::AddAttackPlane(br, 0, showCrit);
    }
}

bool _Bah(Critter br, Critter target, Item weapon, int weaponMode, ProtoItem ammo)
{
    // Kill brahmin
    Map map = br.GetMap();
    Messaging::SayShout(br, "Mooo");
    CritterState::ToDead(br, CritterActionAnim::DeadExplode, null);
    Explode::ExplodeEx(map, br.Hex.x, br.Hex.y, Content::Item::explode_rocket, 2, Game.Random(30, 60), DamageTypes::Explode, 2, ZERO_IDENT);

    // Create new
    mpos hex;
    if (Entrance::GetNearEntry(map, ENTRY_BRAHMIN, hex)) {
        Critter br2 = map.AddCritter(Content::Critter::Brahmin3, hex, Game.Random(0, 5));
        br2.SetupScript(_BrahminInit);
    }
    return true;
}

void Test(Critter cr, int, int, int)
{
    Location loc = Location::CreateLocation(Content::Location::mad_brahmins, ipos(cr.WorldPos.x, cr.WorldPos.y), null);
    Map map = loc.GetMapByIndex(0);
    Obsolete::CritterTransferToMapEntry(cr, map.Id, HASHI(0));
}

#endif

}
