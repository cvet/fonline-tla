namespace EncOceanTrader
{

#if SERVER

// Author: Dagnir, Cracker

#define TIME_TO_DEATH (Time::Minutes(50))

// Если этого торговца убить, то его уже нельзя будет встретить на глобале.

void _TraderInit(Critter npc, bool firstTime)
{
    npc.ReplicationTime = -1;
    npc.IsNoSteal = true;
    npc.StartTimeEvent(TIME_TO_DEATH, cte_HeartAttack);
    npc.OnDead.Subscribe(_TraderDead);
}

void _TraderDead(Critter npc, Critter killer)
{
    Game.EncOceanTraderAlive = false;
}

void cte_HeartAttack(Critter cr)
{
    if (!cr.IsDead()) {
        CritterState::ToDead(cr, CritterActionAnim::DeadFront, null);
    }
    tick_t delayTicks = TIME_TO_DEATH;
    if (delayTicks > 0) {
        Game.RepeatCurrentTimeEvent(delayTicks);
    }
}

void _AmericaInit(Critter npc, bool firstTime)
{
    npc.ReplicationTime = -1;
    npc.MeleeDamageBase += 5;
    npc.CriticalChanceBase = 50;
    npc.SkillUnarmed = 150;
}

#endif

}
